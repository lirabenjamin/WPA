summarise(self = mean(inclself)) %>%
filter(self > 0 & self < 1)
sc %>%
group_by(SubjectID) %>%
mutate(inclself = Relationship %in% c("Self")) %>%
summarise(self = mean(inclself)) %>%
filter(self > 0 & self < 1) %>%
pull(SubjectID)
ValidIDs = sc %>%
group_by(SubjectID) %>%
mutate(inclself = Relationship %in% c("Self")) %>%
summarise(self = mean(inclself)) %>%
filter(self > 0 & self < 1) %>%
pull(SubjectID)
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs)
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(Self = mutate(if_else(Relationship == "Self",T,F)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(Self = mutate(if_else(Relationship == "Self",T,F)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(Self = mutate(if_else(Relationship == "Self",1,0)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(rel = mutate(if_else(Relationship == "Self",1,0)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(rel = mutate(ifelse(Relationship == "Self",1,0)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
filter(Relationship == "Self")
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(rel = mutate(case_when(Relationship == "Self"~1,
Relationship != "Self"~0)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(rel = case_when(Relationship == "Self"~1,
Relationship != "Self"~0))
sc %>%
group_by(SubjectID) %>%
mutate(inclself = Relationship %in% c("Self")) %>%
summarise(self = mean(inclself)) %>%
filter(self > 0 & self < 1)
ValidIDs = sc %>%
group_by(SubjectID) %>%
mutate(inclself = Relationship %in% c("Self")) %>%
summarise(self = mean(inclself)) %>%
filter(self > 0 & self < 1) %>%
pull(SubjectID)
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf)
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs)
library(tidyverse)
# devtools::install_github(repo = "lirabenjamin/Ben",force = T)
library(Ben)
d9 = read.csv("data/WCI_MBA_data_2019.csv")
d0 = read.csv("data/WCI_MBA_data_2020.csv")
d = rbind(d9,d0)
d %>% select(StartDate,EndDate)
sc = d %>% select(X,SubjectID,EvaluatorID,Relationship,
GritPer_scale,
GritPas_scale,
HumMot_scale,
HumRec_scale,
Giver_scale,
Matcher_scale,
Taker_scale,
avg_perf,
year,
class)
ids = d %>% select(X,SubjectID,EvaluatorID,Relationship,year,class)
ids %>% arrange(X)
sc
ids
ids %>% arrange(year,SubjectID)
ids %>% arrange(SubjectID,year)
ids %>% arrange(EvaluatorID,SubjectID)
library(tidyverse)
# devtools::install_github(repo = "lirabenjamin/Ben",force = T)
library(Ben)
d9 = read.csv("data/WCI_MBA_data_2019.csv")
d0 = read.csv("data/WCI_MBA_data_2020.csv")
d = rbind(d9,d0)
d %>% select(StartDate,EndDate)
sc = d %>% select(X,SubjectID,EvaluatorID,Relationship,
GritPer_scale,
GritPas_scale,
HumMot_scale,
HumRec_scale,
Giver_scale,
Matcher_scale,
Taker_scale,
avg_perf,
year,
class)
ids = d %>% select(X,SubjectID,EvaluatorID,Relationship,year,class)
ids %>% arrange(EvaluatorID,SubjectID)
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe %>% ggplot(aes(value))+geom_histogram()
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe %>% ggplot(aes(value))+geom_histogram(bins = 3)
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe %>% ggplot(aes(value))+geom_histogram(bins = 5)
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe %>% ggplot(aes(value))+geom_histogram(bins = 5)+geom_vline(xintercept = 60*3)
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe %>% ggplot(aes(value))+geom_histogram(bins = 5)+geom_vline(xintercept = 60*4)
library(tidyverse)
# devtools::install_github(repo = "lirabenjamin/Ben",force = T)
library(Ben)
d9 = read.csv("data/WCI_MBA_data_2019.csv")
d0 = read.csv("data/WCI_MBA_data_2020.csv")
d = rbind(d9,d0)
d
d %>% select(StartDate,EndDate)
sc = d %>% select(X,SubjectID,EvaluatorID,Relationship,
GritPer_scale,
GritPas_scale,
HumMot_scale,
HumRec_scale,
Giver_scale,
Matcher_scale,
Taker_scale,
avg_perf,
year,
class)
ids = d %>% select(X,SubjectID,EvaluatorID,Relationship,year,class)
ids %>% arrange(EvaluatorID,SubjectID)
sc %>% select(SubjectID) %>% group_by(SubjectID) %>% summarise(n=n()) %>% pull(n) %>% table() #8 evals on avg, 1-43
sc %>% select(SubjectID) %>% group_by(SubjectID) %>% summarise(n=n()) %>% pull(n) %>% mean() #8 evals on avg, 1-43
sc %>% select(SubjectID) %>% group_by(SubjectID) %>% summarise(n=n()) %>% pull(n) %>% sd() #8.59 evals on avg, 1-43
d %>% select(StartDate,EndDate)
sc = d %>% select(X,SubjectID,EvaluatorID,Relationship,
GritPer_scale,
GritPas_scale,
HumMot_scale,
HumRec_scale,
Giver_scale,
Matcher_scale,
Taker_scale,
avg_perf,
year,
class)
ids = d %>% select(X,SubjectID,EvaluatorID,Relationship,year,class)
ids %>% arrange(EvaluatorID,SubjectID)
# Descriptives ####
sc$SubjectID %>% unique() %>% length() #623 unique people were evaluated, 739 total, (116 ppl did it twice)
sc %>% select(SubjectID) %>% group_by(SubjectID) %>% summarise(n=n()) %>% pull(n) %>% sd() #8.59 (5.35) evals on avg, 1-43
sc$EvaluatorID %>% unique() %>% length() #3558 unique people were evaluators
# Do people change from year to year? ####
sc %>%
filter(Relationship =="Self") %>%
mutate(avg_perf = (avg_perf/100)*6+1) %>%
select(-SubjectID,-X,-class,-Relationship) %>%
gather(varaible,value,-year,-EvaluatorID) %>%
ggplot(aes(year,value))+geom_line(aes(group = EvaluatorID))+
facet_wrap(~varaible)
# Do people change from year to year? ####
sc %>%
filter(Relationship =="Self") %>%
mutate(avg_perf = (avg_perf/100)*6+1) %>%
select(-SubjectID,-X,-class,-Relationship) %>%
gather(varaible,value,-year,-EvaluatorID) %>%
ggplot(aes(year,value))+geom_line(aes(group = EvaluatorID))+
facet_wrap(~varaible)+
theme_ang()
# Do people change from year to year? ####
sc %>%
filter(Relationship =="Self") %>%
mutate(avg_perf = (avg_perf/100)*6+1) %>%
select(-SubjectID,-X,-class,-Relationship) %>%
gather(varaible,value,-year,-EvaluatorID) %>%
ggplot(aes(year,value))+
geom_line(aes(group = EvaluatorID),alpha(.3))+
facet_wrap(~varaible)+
theme_ang()
# Do people change from year to year? ####
sc %>%
filter(Relationship =="Self") %>%
mutate(avg_perf = (avg_perf/100)*6+1) %>%
select(-SubjectID,-X,-class,-Relationship) %>%
gather(varaible,value,-year,-EvaluatorID) %>%
ggplot(aes(year,value))+
geom_line(aes(group = EvaluatorID),alpha=.3)+
facet_wrap(~varaible)+
theme_ang()
# Do people change from year to year? ####
sc %>%
filter(Relationship =="Self") %>%
mutate(avg_perf = (avg_perf/100)*6+1) %>%
select(-SubjectID,-X,-class,-Relationship) %>%
gather(varaible,value,-year,-EvaluatorID) %>%
ggplot(aes(year,value))+
geom_line(aes(group = EvaluatorID),alpha=.3)+
facet_wrap(~varaible)+
scale_x_continuous(breaks = c(2019,2020))
# Do people change from year to year? ####
sc %>%
filter(Relationship =="Self") %>%
mutate(avg_perf = (avg_perf/100)*6+1) %>%
select(-SubjectID,-X,-class,-Relationship) %>%
gather(varaible,value,-year,-EvaluatorID) %>%
ggplot(aes(year,value))+
geom_line(aes(group = EvaluatorID),alpha=.3)+
facet_wrap(~varaible)+
scale_x_continuous(breaks = c(2019,2020))+
scale_y_continuous(breaks = 1:7)+
theme_ang()
# Do people change from year to year? ####
sc %>%
filter(Relationship =="Self") %>%
mutate(avg_perf = (avg_perf/100)*6+1) %>%
select(-SubjectID,-X,-class,-Relationship) %>%
gather(varaible,value,-year,-EvaluatorID) %>%
ggplot(aes(year,value))+
geom_line(aes(group = EvaluatorID),alpha=.3)+
facet_wrap(~varaible,nrow = 2)+
scale_x_continuous(breaks = c(2019,2020))+
scale_y_continuous(breaks = 1:7)+
theme_ang()
d
# Is there variability within? ####
library(lme4)
data = sc %>% mutate(Value = GritPer_scale)
withinvar = function(data){
lme = lme4::lmer(formula = Value ~ 1 + (1 | SubjectID),data=data) %>% VarCorr() %>% as.data.frame()
cov = lme$vcov[2]/(lme$vcov[1]+lme$vcov[2])
cor = lme$sdcor[2]/(lme$sdcor[1]+lme$sdcor[2])
return(cov)
}
iccs = bind_rows(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021))
iccs %>% select(year,Outcome,ICC) %>%
mutate(year = case_when(year == 2019 ~ "2019",
year == 2020 ~ "2020",
year == 2021 ~ "Both"),
ICC = numformat(ICC)) %>%
spread(year,ICC) %T>%
write.clip()
library(magrittr)
mutate(ICC= map_dbl(data,withinvar)
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= 1-map_dbl(data,withinvar))
write_rds(sc,"sc.rds")
write_rds(sc,"Data/sc.rds")
#write_rds(sc,"Data/sc.rds")
readRDS(url("https://github.com/lirabenjamin/WPA/blob/main/Data/sc.rds", method="libcurl"))
#write_rds(sc,"Data/sc.rds")
read_rds(url("https://github.com/lirabenjamin/WPA/blob/main/Data/sc.rds", method="libcurl"))
?read_rds
# Psychometrics ####
d %>% select(starts_with("Grit"))
# Psychometrics ####
d %>%
select(starts_with("Grit")&str_detect("scale")) %>%
# Do people change from year to year? ####
sc %>%
filter(Relationship =="Self") %>%
mutate(avg_perf = (avg_perf/100)*6+1) %>%
select(-SubjectID,-X,-class,-Relationship) %>%
gather(varaible,value,-year,-EvaluatorID) %>%
ggplot(aes(year,value))+
geom_line(aes(group = EvaluatorID),alpha=.3)+
facet_wrap(~varaible,nrow = 2)+
scale_x_continuous(breaks = c(2019,2020))+
scale_y_continuous(breaks = 1:7)+
theme_ang()
# Psychometrics ####
d %>%
select(starts_with("Grit")&str_detect("scale"))
# Psychometrics ####
d %>%
select(starts_with("Grit")&str_detect("scale"))
# Psychometrics ####
d %>%
select(starts_with("Grit")&str_detect(.,"scale"))
# Psychometrics ####
d %>%
select(starts_with("Grit")&str_detect(colnames(d),"scale"))
str_detect(colnames(d),"scale")
# Psychometrics ####
d %>%
select(starts_with("Grit")&matches("scale"))
# Psychometrics ####
d %>%
select(starts_with("Grit")&!matches("scale"))
# Psychometrics ####
d %>%
select(starts_with("Grit")&!matches("scale")) %>%
psych::alpha
# Psychometrics ####
d %>%
select(starts_with("Grit")&!matches("scale")) %>%
psych::alpha()
# Psychometrics ####
d %>%
select(starts_with("Grit")&!matches("scale")) %>%
#psych::alpha()
psych::fa(nfactors = 2,rotate = "variamax")
library(psych)
# Psychometrics ####
d %>%
select(starts_with("Grit")&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 2,rotate = "variamax") %>%
print.psych(digits = 2, cut = .3)
# Psychometrics ####
d %>%
select(starts_with("Grit")&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 2,rotate = "variamax") %>%
print.psych(digits = 2, cut = .3,sort= T)
# Psychometrics ####
d %>%
select(starts_with("Grit")&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 2,rotate = "varimax") %>%
print.psych(digits = 2, cut = .3,sort= T)
# Psychometrics ####
d %>%
select(starts_with("Grit")&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 2,rotate = "promax") %>%
print.psych(digits = 2, cut = .3,sort= T)
# Psychometrics ####
scale = "GritPas"
d %>%
select(starts_with(scale)&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 2,rotate = "promax") %>%
print.psych(digits = 2, cut = .3,sort= T)
# Psychometrics ####
scale = "GritPers"
d %>%
select(starts_with(scale)&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 2,rotate = "promax") %>%
print.psych(digits = 2, cut = .3,sort= T)
# Psychometrics ####
scale = "GritPer"
d %>%
select(starts_with(scale)&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 2,rotate = "promax") %>%
print.psych(digits = 2, cut = .3,sort= T)
# Psychometrics ####
scale = "Hum"
d %>%
select(starts_with(scale)&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 2,rotate = "promax") %>%
print.psych(digits = 2, cut = .3,sort= T)
# Psychometrics ####
scale = "Perf"
d %>%
select(starts_with(scale)&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 2,rotate = "promax") %>%
print.psych(digits = 2, cut = .3,sort= T)
d %>%
select(starts_with(scale)&!matches("scale")) %>%
psych::alpha()
d
d %>% colnames()
rename_at(29:41,function(x){paste0("RS.",x)})
rename_at(29,function(x){paste0("RS.",x)})
?rename_at
rename_at(vars(Giver_1:Taker_8),function(x){paste0("RS.",x)})
rename_at(vars(Giver_1:Taker_8),toupper})
rename_at(vars(Giver_1:Taker_8),toupper)
mtcars %>% rename_at(vars(mpg:hp), toupper)
rename_at(vars(Giver_1:Taker_8),toupper)
rename_at(Giver_1:Taker_8,toupper)
rename_at(4,toupper)
rename_at(4:5,toupper)
rename_at(c(3,6,8,5),toupper)
d %>%
rename_at(c(3,6,8,5),toupper)
d %>%
rename_at(vars(Giver_1:Taker_8),function(x){paste0("RS.",x)})
d %>%
rename_at(vars(Giver_1:Taker_8),function(x){paste0("RS",x)}) %>%
select(starts_with(scale)&!matches("scale")) %>%
psych::alpha()
d %>%
rename_at(vars(Giver_1:Taker_8),function(x){paste0("RS",x)}) %>%
select(starts_with(scale)&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 3,rotate = "promax") %>%
print.psych(digits = 2, cut = .3,sort= T)
# Psychometrics ####
scale = "RS"
d %>%
rename_at(vars(Giver_1:Taker_8),function(x){paste0("RS",x)}) %>%
select(starts_with(scale)&!matches("scale")) %>%
#psych::alpha()
fa(nfactors = 3,rotate = "promax") %>%
print.psych(digits = 2, cut = .3,sort= T)
?psych::ICC
