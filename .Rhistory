return(cov)
}
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map(data,withinvar))
withinvar = function(){
lme = sc %>% lme4::lmer(formula = Value ~ 1 + (1 | SubjectID)) %>% VarCorr() %>% as.data.frame()
cov = lme$vcov[2]/(lme$vcov[1]+lme$vcov[2])
cor = lme$sdcor[2]/(lme$sdcor[1]+lme$sdcor[2])
return(cov)
}
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map(data,withinvar))
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf)
withinvar = function(data){
lme = data %>% lme4::lmer(formula = Value ~ 1 + (1 | SubjectID)) %>% VarCorr() %>% as.data.frame()
cov = lme$vcov[2]/(lme$vcov[1]+lme$vcov[2])
cor = lme$sdcor[2]/(lme$sdcor[1]+lme$sdcor[2])
return(cov)
}
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map(data,withinvar))
(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest())[1,3] %>% unnest()
(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest())[1,3] %>% unnest() %>% withinvar()
(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest())[1,3] %>% unnest() %>% withinvar(.)
(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest())[1,3] %>% unnest() %>% withinvar(data-.)
(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest())[1,3] %>% unnest() %>% withinvar(data=.)
data = sc
data = sc %>% mutate(Value = GritPer_scale)
lme = data %>% lme4::lmer(formula = Value ~ 1 + (1 | SubjectID)) %>% VarCorr() %>% as.data.frame()
data
data %>% lme4::lmer(formula = Value ~ 1 + (1 | SubjectID))
data %>% lme4::lmer(formula = Value ~ 1 + (1 | SubjectID),data=.)
lme4::lmer(formula = Value ~ 1 + (1 | SubjectID),data=data)
withinvar = function(data){
lme = lme4::lmer(formula = Value ~ 1 + (1 | SubjectID),data=data) %>% VarCorr() %>% as.data.frame()
cov = lme$vcov[2]/(lme$vcov[1]+lme$vcov[2])
cor = lme$sdcor[2]/(lme$sdcor[1]+lme$sdcor[2])
return(cov)
}
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map(data,withinvar))
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome)
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021)
bind_rows(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021))
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021)) %>%
select(year,Outcome,ICC)
bind_rows(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021))
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021)) %>%
ungroup() %>%
select(year,Outcome,ICC)
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021)) %>%
ungroup() %>%
dplyr::select(year,Outcome,ICC)
bind_rows(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021))
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021)) %>%
select(-data)
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021)) %>%
select(-data)
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021)) %>%
dyplr::select(-data)
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021)) %>%
dplyr::select(-data)
iccs = bind_rows(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021))
iccs
iccs %>% select(year,Outcome)
iccs %>% select(year,Outcome,ICC)
iccs %>% select(year,Outcome,ICC) %>%
spread(year,ICC)
iccs %>% select(year,Outcome,ICC) %>%
mutate(year = case_when(year == 2019 ~ "2019",
year == 2020 ~ "2020",
year == 2021 ~ "Both"))
iccs %>% select(year,Outcome,ICC) %>%
mutate(year = case_when(year == 2019 ~ "2019",
year == 2020 ~ "2020",
year == 2021 ~ "Both")) %>%
spread(year,ICC)
iccs %>% select(year,Outcome,ICC) %>%
mutate(year = case_when(year == 2019 ~ "2019",
year == 2020 ~ "2020",
year == 2021 ~ "Both")) %>%
spread(year,ICC) %>% write.clip()
iccs %>% select(year,Outcome,ICC) %>%
mutate(year = case_when(year == 2019 ~ "2019",
year == 2020 ~ "2020",
year == 2021 ~ "Both")) %>%
spread(year,ICC) %>%
write.clip()
iccs %>% select(year,Outcome,ICC) %>%
mutate(year = case_when(year == 2019 ~ "2019",
year == 2020 ~ "2020",
year == 2021 ~ "Both"),
ICC = numformat(ICC)) %>%
spread(year,ICC) %>%
write.clip()
iccs = bind_rows(sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome,year) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar))
,
sc %>%
select(SubjectID,year,GritPer_scale:avg_perf) %>%
gather(Outcome, Value,-year,-SubjectID) %>%
group_by(Outcome) %>%
nest() %>%
mutate(ICC= map_dbl(data,withinvar),
year = 2021))
iccs %>% select(year,Outcome,ICC) %>%
mutate(year = case_when(year == 2019 ~ "2019",
year == 2020 ~ "2020",
year == 2021 ~ "Both"),
ICC = numformat(ICC)) %>%
spread(year,ICC) %>%
write.clip()
# RSAs ####
library(RSA)
?RSA
sc
sc %>%
select(SubjectID,Relationship,GritPas_scale,avg_perf)
sc %>%
select(SubjectID,Relationship,GritPas_scale,avg_perf) %>%
spread(Relationship,GritPas_scale)
sc %>%
select(SubjectID,Relationship,GritPas_scale,avg_perf) %>%
filter(Relationship == "SelF")
sc %>%
select(SubjectID,Relationship,GritPas_scale,avg_perf) %>%
filter(Relationship == "Self")
sc %>% group_by(SubjectID) %>% mutate(inclself = Relationship %in% c("Self"))
sc %>% group_by(SubjectID) %>% mutate(inclself = Relationship %in% c("Self")) %>%
select(Relationship,inclself)
sc %>% group_by(SubjectID) %>% mutate(inclself = Relationship %in% c("Self")) %>%
select(Relationship,inclself) %>%
filter(Relationship == "Self")
sc %>% group_by(SubjectID) %>% mutate(inclself = Relationship %in% c("Self")) %>%
select(Relationship,inclself) %>%
filter(SubjectID == "P_02urntVE8Kf5577")
sc %>% group_by(SubjectID) %>% mutate(inclself = Relationship %in% c("Self")) %>%
select(Relationship,inclself) %>%
filter(SubjectID == "P_02urntVE8Kf5577")
sc %>%
group_by(SubjectID) %>%
mutate(inclself = Relationship %in% c("Self")) %>%
summarise(self = mean(inclself))
sc %>%
select(Relationship,inclself) %>%
filter(SubjectID == "P_00c0h5g6FtIJEdT")
sc %>%
filter(SubjectID == "P_00c0h5g6FtIJEdT")
sc %>%
group_by(SubjectID) %>%
mutate(inclself = Relationship %in% c("Self")) %>%
summarise(self = mean(inclself)) %>%
filter(self > 0 & self < 1)
sc %>%
group_by(SubjectID) %>%
mutate(inclself = Relationship %in% c("Self")) %>%
summarise(self = mean(inclself)) %>%
filter(self > 0 & self < 1) %>%
pull(SubjectID)
ValidIDs = sc %>%
group_by(SubjectID) %>%
mutate(inclself = Relationship %in% c("Self")) %>%
summarise(self = mean(inclself)) %>%
filter(self > 0 & self < 1) %>%
pull(SubjectID)
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs)
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(Self = mutate(if_else(Relationship == "Self",T,F)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(Self = mutate(if_else(Relationship == "Self",T,F)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(Self = mutate(if_else(Relationship == "Self",1,0)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(rel = mutate(if_else(Relationship == "Self",1,0)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(rel = mutate(ifelse(Relationship == "Self",1,0)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
filter(Relationship == "Self")
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(rel = mutate(case_when(Relationship == "Self"~1,
Relationship != "Self"~0)))
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs) %>%
group_by(SubjectID) %>%
mutate(avg_perf_m = mean(avg_perf)) %>%
ungroup() %>%
mutate(rel = case_when(Relationship == "Self"~1,
Relationship != "Self"~0))
sc %>%
group_by(SubjectID) %>%
mutate(inclself = Relationship %in% c("Self")) %>%
summarise(self = mean(inclself)) %>%
filter(self > 0 & self < 1)
ValidIDs = sc %>%
group_by(SubjectID) %>%
mutate(inclself = Relationship %in% c("Self")) %>%
summarise(self = mean(inclself)) %>%
filter(self > 0 & self < 1) %>%
pull(SubjectID)
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf)
sc %>%
select(SubjectID,year,Relationship,GritPas_scale,avg_perf) %>%
filter(SubjectID %in% ValidIDs)
library(tidyverse)
# devtools::install_github(repo = "lirabenjamin/Ben",force = T)
library(Ben)
d9 = read.csv("data/WCI_MBA_data_2019.csv")
d0 = read.csv("data/WCI_MBA_data_2020.csv")
d = rbind(d9,d0)
d %>% select(StartDate,EndDate)
sc = d %>% select(X,SubjectID,EvaluatorID,Relationship,
GritPer_scale,
GritPas_scale,
HumMot_scale,
HumRec_scale,
Giver_scale,
Matcher_scale,
Taker_scale,
avg_perf,
year,
class)
ids = d %>% select(X,SubjectID,EvaluatorID,Relationship,year,class)
ids %>% arrange(X)
sc
ids
ids %>% arrange(year,SubjectID)
ids %>% arrange(SubjectID,year)
ids %>% arrange(EvaluatorID,SubjectID)
library(tidyverse)
# devtools::install_github(repo = "lirabenjamin/Ben",force = T)
library(Ben)
d9 = read.csv("data/WCI_MBA_data_2019.csv")
d0 = read.csv("data/WCI_MBA_data_2020.csv")
d = rbind(d9,d0)
d %>% select(StartDate,EndDate)
sc = d %>% select(X,SubjectID,EvaluatorID,Relationship,
GritPer_scale,
GritPas_scale,
HumMot_scale,
HumRec_scale,
Giver_scale,
Matcher_scale,
Taker_scale,
avg_perf,
year,
class)
ids = d %>% select(X,SubjectID,EvaluatorID,Relationship,year,class)
ids %>% arrange(EvaluatorID,SubjectID)
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe %>% ggplot(aes(value))+geom_histogram()
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe %>% ggplot(aes(value))+geom_histogram(bins = 3)
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe %>% ggplot(aes(value))+geom_histogram(bins = 5)
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe %>% ggplot(aes(value))+geom_histogram(bins = 5)+geom_vline(xintercept = 60*3)
c(234,
271,
193,
226,
284,
183,
224,
242,
207) %>% enframe %>% ggplot(aes(value))+geom_histogram(bins = 5)+geom_vline(xintercept = 60*4)
